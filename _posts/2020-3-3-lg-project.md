---
layout: post
title: "面试题-个人项目"
date:   2020-3-3
tags: 
  - Golang
comments: true
author: feng6917
---

`持续更新中...`

<!-- more -->

<SCRIPT language=JavaScript>

function password() {

    var testV=0;

    var pass1=prompt('赶紧输密码:', '');

    while (testV < 3) {

        if ( !pass1) history.go(-1);

        if (pass1=="myz") {

            alert('密码正确!');

            break;

        }

        testV+=1;

        if (testV==1) {
            pass1=prompt('密码错了，搞什么啊！还剩两次机会。');
        }

        else if (testV==2) {
            pass1=prompt('密码错了，搞什么啊！还剩一次机会。');
        }

    }

    if (pass1 !="password" & testV==3) history.go(-1);

    return " ";

}

document.write(password());

</SCRIPT>

**项目是做什么的？**

**项目中负责什么？**

***项目中用到了哪些技术？***

**项目中的收获，不足的地方？**

## 目录

- [蜂鸟重构](#蜂鸟重构)
- []()

---

- [平台重构](#平台重构)
  - [权限模块](#权限模块)
  - [数据迁移](#数据迁移)
- [图像识别](#图像识别)
- [行政区划](#行政区划)

---

#### 蜂鸟重构

1. 动态缩略图配置
![img](../images/2020-3-3/13.jpg)

2. 各种优化
    - 表分区：按天进行分区
    - 表垂直拆分：增加副表，将不常用字段拆分到副表
    - 表链接优化：使用各字段值组合拼接，减少表链接
    - 表字段优化：字段类型优化，字段长度优化，字段枚举优化，字段默认值优化，字段索引优化, 浮点数*255，选择合适数值类型
    - 缓存优化：查询数据Redis 缓存，查询详情 设置时间范围（等同于指定分区）
    - 统计优化：定制统计表，累计不同类型数据数量
    - 视频分片：长视频拆分，根据平台拆分分片，重复利用分片

3. 流程图、协议、接口文档等

#### 平台重构

原因：
> 为了解决平台混乱关系，增加服务的可扩展性，基础结构的一致性，对现有平台进行重构。

负责内容：
> 负责权限模块、业务接口、数据迁移等；

###### 权限模块
>
> 负责权限表设计，及基础接口提供，权限基于RBAC，包含 角色、权限、操作、资源 四个部门

1. 操作表示怎么做，或读或写或跳转等；
2. 资源表示操作谁，订单，企业，权限管理等；
3. 权限是操作和资源的组合，表示怎么做，操作谁，查看订单，修改企业等，内部结构有操作ID于资源ID组成；
4. 角色 可以认为一类人的统称，有某一个或多个权限，与人员进行绑定，比如管理员，普通用户；
5. 整体上的关系是 人跟角色关联，角色跟权限关联，权限由操作和资源组成；人关联了角色，将拥有这个角色下的权限。

不足：

1. 数据表不够灵活；角色权限关联表，如果存在部门或者组与权限进行关联，是否需要重新建立一个关联表，能否合二为一，相应的会有冗余字段，用于标识关联类型是角色权限还是组权限还是其他

2. 页面可配置操作及资源是否合理，设置成功后是否有效？

###### 数据迁移
>
> 负责全量及增量迁移，负责MySQL到PG切换；

1. 全量迁移：
    1. 理清业务逻辑，迁移的数据所对应的迁移后数据表
    2. 数据表表字段换（包含字段类型，长度，枚举等），唯一对应值关系映射表搭建
    3. 数据表数据校验，数据量校验及抽取+首位值校验
    4. 数据表 ID 范围记录，留有一定长度做区分或特殊处理
    5. 迁移日期记录 特殊数据处理

2. 增量迁移：
    1. 数据调整以迁移后数据为准，迁移前数据调整不做处理
    2. 从上次记录位置开始调整

3. MySQL 到PG切换：
    - 代码调整
    - 数据调整
        1. 区分大小写处理
        2. Group By 分组处理
        3. 字段零值处理
        4. 字段类型处理
        5. 函数不一致处理

不足：
​ 该迁移为宕机迁移，对用户体验不是很好，是否可以无感迁移，动态迁移？

#### 图像识别

对原有服务代码量，及接口调用的优化；

需要注意的点：

1. 优化后，接口返回状态值不变，避免接入该服务的app异常。
2. 优化后，配置文件的删改记录要进行留档

操作步骤：

 1. 梳理逻辑，画序列图
 2. 主要部分分为两个阶段，生成索引和加载索引；完整的处理流程如下：
      1. 服务器接收到识别图
      2. 对识别图进行校验 （是否已经识别，是否符合尺寸要求，图片复杂度是否符合）
      3. 异步处理；放入发布索引channel，返回发布中状态给客户端。
      4. 从channel取出识别图，发送到索引生成服务器
      5. 索引生成服务器 处理完成后，请求原服务器，原服务器接收索引地址，修改数据表索引信息，生成索引状态，生成索引完成，发送请求 到下载服务器。
      6. 下载服务器接收请求后，根据识别图ID获取索引地址，请求下载内容，存储数据到本机的加载服务器相应文件夹下，用于识别图识别加载。

学会了序列图，学会了如何将一层层关系展示出来，更易于理解，开发。

不足：项目代码是在原项目代码的基础上进行调整，结构显得臃肿，接口状态码没有进行更改，融入其他服务接口状态码，关系混乱，易搞混。

#### 行政区划

前期调研，通过对世界行政区划比较，有两个问题，1. 层级，不同国家层级不同，关系混乱，会出现特殊情况。2. 数据不充分，不准确，已存在的统计数据具有延后性。综合考虑通过调用服务接口来进行数据处理，仅处理国内数据。

国家是在GOOLE上搜索到的最近一份国家统计数据，对其进行下载解析；然后根据国家统计局的行政区划进行处理，然后发现地区不够精确，通过高德地图行政区划接口进行处理；台湾省特殊处理,高德地图获取台湾下级区无法获取。
